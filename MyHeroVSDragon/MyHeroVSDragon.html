<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 8</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
  </head>
  <body>

  <script type="text/javascript">

    var player;
	var playingState = 0;//0: new 1: loss 2: win//
	var playerDieTime;
	var princess;
	
	var heart;
	var heart1;
	var playerPosX=880;
	var playerPosY=450;
	var model;
	var DIETime = 0;
	var playerBlood = 100;
    var platforms;
    var cursors;
	var spacebar,spaceV,spaceT,spaceM;
    var speed=160;
    var flipFlop = true;
	var flipFlop1 = true;
    var timedEvent,tween;
   //new variable
    var playerAttack;
	var attackAreas;
    var right,left;//player direction
    var canMove = true;
    var rightAnimation;
	var scene3_ctr=0;
	
	var pressOnce0 = true;
	var pressOnce1 = true;
	
	var KeyDoor;
	var KeyID=[false,false];//grap a key//
    var DragonC;
	var textBlood;
	var textSetting;
	var wordsSetting;
	var sceneName;
	var jump_b = false;
    var timer = 0;//player get hurt//
	var realtime =0;
	var apple_num=5;
    //arrow attack//
    var mode = 0;//choose which characters//
    var swords;
	var specialBomb;
    var arrows;
    var arrowspeed;
    var arrowAngle = [5,45];
    //npc//
    var npc0 ;
    var npc1 ;
	//talk//
	var notices = [0,1];
	var textBox = [0,1];
	var talkState = [0,0];
	var npc0D = false;//overlap?
	var npc1D = false;//overlap?
	var scene3pass= false;
    var goTo0;//change scene//
	var goTo1;//change scene//
	var goTo2;//change scene//
	var goTo3;
	var goTo4= [0,0];
	
	var dummy;
	var boss = [0,1,2,3];
	var bossblood = [100,100,100,10];
	var bosstimedEvent = [0,1,2,3,4,5,6,7];//7 timer//
	var bossDes=[0,1,2];
	var bossAct=-2;
	var bossenable=false;
	var bosstimer=[0,1];
	var bossAttacks;
	var bosssuperpower=2;
	var bossDir = 2;//0 for left 1or right//
	var enemiesAttack;
	var enemies;// enemy//
    var enemyTimer=0;//enemy attack time//
	var apple_s_y;
	var apple_p_x;
	var apple_time=1000;
	var apple_size=0.05;
	var monkey_speed =100;
	var scene3_lv=1;
	var move_platforms; //for scene2 item//	
	var scene3_time;
	var music;
	var Scene3Boss;
	var soundEvent = [0,1];
	var scene3Boss;
	
	var player_checkpoint_x;//for scene2
	var player_checkpoint_y;//for scene2
	var scene2_reload=false;//for scene2
	var scene2_reached_bossstage=false;//for scene2
	
    var Scene0 = new Phaser.Class({
      Extends: Phaser.Scene,
      initialize:
      function Scene0 ()//scene0 setting//
      {
        Phaser.Scene.call(this, { key: 'scene0' });
      },

      preload: function(){
        //mode = 0; //0 for arrow ;1 for sword //
        right = false;
        left = false;
        this.load.image('arrow','assets/characters/arrow1.png');
        this.load.spritesheet('player1','assets/characters/playerarmor.png',
        { frameWidth: 64, frameHeight: 64 });//player_swards.png
        this.load.spritesheet('player0','assets/characters/player_swards.png',
        { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('NPCMode','assets/NPCs/NPC.png',
        { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('glowsword','assets/characters/glowsword_red_female.png',
        { frameWidth: 192, frameHeight: 192 });
        //this.load.image('red','/assets/pointer/red.png');
		this.load.spritesheet('red','/assets/pointer/portal.png',
		{ frameWidth: 120, frameHeight: 90 });
        //scene0preload.call(this);// for scene0		
	  this.load.image('background brick', 'assets/Scene0/background/castle_tileset_part1 (2) (1).png');
      this.load.image('collde brick', 'assets/Scene0/background/castle_tileset_part1 (4) (4).png');
      this.load.image('collde platform', 'assets/Scene0/background/castle_tileset_part1 (5) (1).png');
      this.load.image('collde ceiling', 'assets/Scene0/background/castle_tileset_part1 (4) (2).png');
      this.load.image('collde stair', 'assets/Scene0/background/castle_tileset_part1 (4) (1).png');
      this.load.image('notice', 'assets/Scene0/background/Notitz.png');
      this.load.bitmapFont('nokia', 'assets/Scene0/font/nokia16black.png', 'assets/Scene0/font/nokia16black.xml');
      this.load.image('dummy', 'assets/Scene0/enemy/combat_dummy.png');
      this.load.image('door', 'assets/Scene0/background/castle_tileset_part3 (1).png');
      this.load.image('candle1', 'assets/Scene0/background/castle_tileset_part3 (7).png');
      this.load.image('candle2', 'assets/Scene0/background/castle_tileset_part3 (8).png');
      this.load.image('candle3', 'assets/Scene0/background/castle_tileset_part3 (9).png');
      this.load.image('candle4', 'assets/Scene0/background/castle_tileset_part3 (10).png');
      this.load.image('candle0', 'assets/Scene0/background/castle_tileset_part2 (1).png');				
		
      },

      create: function(){
	  sceneName = 'scene0';
        //<scene>//
        //scene0create.call(this);
		
	  this.cameras.main.setBounds(0, 0, 1800, 600);
      this.physics.world.setBounds(0, 0, 1800, 600);
      platforms = this.physics.add.staticGroup();
      //console.log(platforms);

      //create background brick
      for(let k=0;k<10;k+=2)
      {
        for(let i =0;i<30;i++ )
        {
          let scale=2;
          let width=32*scale, height=32*scale;
          this.add.image(i*width,k*height,'background brick').setScale(scale);
          this.add.image(i*width+width/2,(k+1)*height,'background brick').setScale(scale);
        }
      }

      //create collide platforms
      for(let i =0;i<30;i++ )
     {
      let scale=2;
      let width=32*scale, height=32*scale;
      platforms.create(i*width,height*9,'collde brick').setScale(scale).refreshBody();
     }
     for(let i =0;i<20;i++ )
     {
      let scale=2;
      let width=32*scale, height=32*scale;
      platforms.create((i+12)*width,height*8,'collde brick').setScale(scale).refreshBody();
     }
      this.add.image(0,0,'collde ceiling').setScale(2.5);
      this.add.image(1800,0,'collde ceiling').setScale(2.5);
      platforms.create(600,400,'collde platform').setScale(2).refreshBody();

      //create tutorial
      notice=this.add.image(150,375,'notice');
      notice.setScale(1,0.3);
      text=this.add.bitmapText(150-64, 375-15, 'nokia', 'Press A or D\n to move', 16);
      text.x += (notice.width - text.width) / 2;

      notice=this.add.image(400,375,'notice');
      notice.setScale(1,0.3);
      text=this.add.bitmapText(400-64, 375-15, 'nokia', 'Press W\n to jump', 16);
      text.x += (notice.width - text.width) / 2;

      notice=this.add.image(850,350,'notice');
      notice.setScale(1,0.3);
      text=this.add.bitmapText(850-64, 350-15, 'nokia', 'Press spacebar\n to attack', 16);
      text.x += (notice.width - text.width) / 2;
      //create dummy
      dummy = this.physics.add.sprite(1000,64*8-64,'dummy');
      dummy.setScale(1.2).setSize(23,60).setOffset(21,0);

      this.add.image(1650,64*8-128,'door').setScale(1.5);

      createcandle.call(this,275,250);
      createcandle.call(this,775,250);
      createcandle.call(this,1375,250);
	  //
		
		
  	    //key register//
  	    keyRegistion.call(this);
		
		//portal_creation//
		
		goTo1 = this.physics.add.sprite(1600, 48, 'red').setScale(1.5);
        this.anims.create({
             key: 'portal_A',
             frames: this.anims.generateFrameNumbers('red', { start: 0, end: 63 }),
             frameRate: 10,
             repeat: -1
        });        
        this.physics.add.collider(goTo1, platforms);
		goTo1.anims.play('portal_A', true);
		console.log(goTo1);
  	    //create character//
		console.log("mode: "+mode);
         if (mode == 0) player0Creation.call(this,100,450);//sword player//
         else player1Creation.call(this,100,450);//arrow player//

        arrows = this.physics.add.group();

        this.physics.add.collider(platforms, arrows, arrowHit, null, this);
        this.physics.add.collider(player, arrows , playerHit, null, this);
        this.physics.add.overlap(player, npc0, NPCOverlap, null, this);
        this.physics.add.overlap(player, npc1, NPCOverlap, null, this);
        this.physics.add.overlap(player, goTo1, ChangeScene, null, this);
		

  	    this.cameras.main.startFollow(player, true, 0.08, 0.08);

        nomarlText.call(this);
        scene0createcollider.call(this);
      },

      update: function(){	    		
	    wordsSetting='Scene0';
        playerMovement.call(this);

	 
  	  	 if (spaceV.isDown && flipFlop1){
  		    flipFlop1 = false;
  		    if (speed == 160){
  		      speed = 80;
  		    }else {
  		      speed = 160;
  		    }
  		  }
  	     if(spaceV.isUp && !flipFlop1) {
  	    	flipFlop1 = true;
  		  }

      }

    });

    var Scene1 = new Phaser.Class({//outside castle//
      Extends: Phaser.Scene,
      initialize:
      function Scene1 ()//scene1 setting//
      {
        Phaser.Scene.call(this, { key: 'scene1' });
      },

      preload: function(){

        right = false;
        left = false;
        this.load.image('arrow','assets/characters/arrow1.png');
        this.load.spritesheet('player1','assets/characters/playerarmor.png',
        { frameWidth: 64, frameHeight: 64 });//player_swards.png
        this.load.spritesheet('player0','assets/characters/player_swards.png',
        { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('NPCMode','assets/NPCs/NPC.png',
        { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('glowsword','assets/characters/glowsword_red_female.png',
        { frameWidth: 192, frameHeight: 192 });
		this.load.image('red','/assets/pointer/red.png');
		this.load.spritesheet('red2','/assets/pointer/portal.png',
		{ frameWidth: 120, frameHeight: 90 });
		this.load.image('notice', 'assets/Scene0/background/Notitz.png');
		this.load.bitmapFont('nokia', 'assets/Scene0/font/nokia16black.png', 'assets/Scene0/font/nokia16black.xml');
        scene1preload.call(this);
		PreLoadScene1Enemies.call(this);
      },

      create: function(){
	    sceneName = 'scene1';
        //<scene>//
        scene1create.call(this);
        //key register//
        keyRegistion.call(this);

		goTo2 = this.physics.add.sprite(50, 450, 'red2');
		goTo3 = this.physics.add.sprite(1690,450,'red2');
				
        this.physics.add.collider(goTo2, platforms);
		this.physics.add.collider(goTo3, platforms);
		
		this.anims.create({//for partol animation//
             key: 'portal_A',
             frames: this.anims.generateFrameNumbers('red2', { start: 0, end: 63 }),
             frameRate: 10,
             repeat: -1
        });
		
		goTo3.anims.play('portal_A', true);
		goTo2.anims.play('portal_A', true);
		 //npc create//
        NPCCreation.call(this,850,450);

        //create character//
        if (mode == 0) player0Creation.call(this,playerPosX,playerPosY);//sword player//
         else player1Creation.call(this,880,450);//arrow player//
		 console.log("mode: "+mode);		 
		 player.body.setVelocity(0,0);
		
		if (!canMove){
		canMove = true;	
		this.scene.restart();
		}	
		
        arrows = this.physics.add.group();
		enemies = this.physics.add.group();
		//set up enemy//
		CreateScene1Enemies.call(this,300,500);
		CreateScene1Enemies.call(this,500,500);
		CreateScene1Enemies.call(this,1000,500);
		CreateScene1Enemies.call(this,1300,500);
		
        this.physics.add.collider(platforms, arrows, arrowHit, null, this);
        this.physics.add.collider(player, arrows , playerHit, null, this);
        this.physics.add.overlap(player, npc0, NPCOverlap, null, this);
        this.physics.add.overlap(player, npc1, NPCOverlap, null, this);
		this.physics.add.overlap(player, goTo2, ChangeScene, null, this);
		this.physics.add.overlap(player, goTo3, ChangeScene, null, this);
		
        this.cameras.main.startFollow(player, true, 0.08, 0.08);

        //set text//
		NPCBoxCreation.call(this);
		nomarlText.call(this);
        scene1createcollider.call(this);
		
      },

      update: function(){
        //player movement//        
		if (playingState==0) playerMovement.call(this);
		else {
		  player.body.setVelocity(0,0);
		  swords.anims.play('stay');
		}
		detectPlayerBlood.call(this);
		
		TextBoxReset.call(this);//check textbox;
        NPCMovement.call(this);//NPC move//

         if(spaceT.isDown && flipFlop){//for next talk//
		   if (npc0D)talkState[0]+=1;
		   if(npc1D) talkState[1]+=1;
		   console.log(flipFlop);
           flipFlop = false;		   
		 }
          if (spaceT.isUp && !flipFlop){
		    flipFlop = true;
		  }	
       			
      }

    });

	var Scene2 = new Phaser.Class({//cliffs scene//
      Extends: Phaser.Scene,
      initialize:
      function Scene2 ()//scene2 setting//
      {
        Phaser.Scene.call(this, { key: 'scene2' });
      },

      preload: function(){
        //mode = 0; //1 for arrow ;0 for sword //
        right = false;
        left = false;
		this.load.image('red','/assets/pointer/red.png');
        this.load.image('arrow','assets/characters/arrow1.png');
        this.load.spritesheet('player1','assets/characters/playerarmor.png',
        { frameWidth: 64, frameHeight: 64 });//player_swards.png
        this.load.spritesheet('player0','assets/characters/player_swards.png',
        { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('NPCMode','assets/NPCs/NPC.png',
        { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('glowsword','assets/characters/glowsword_red_female.png',
        { frameWidth: 192, frameHeight: 192 });		
		//for key//
		this.load.spritesheet('Keys','assets/KeyIcons.png',{frameWidth: 32,frameHeight: 32 });
        scene2preload.call(this);
		PreLoadScene2Enemies.call(this);
		PreLoadScene1Enemies.call(this);
      },

      create: function(){
	    sceneName = 'scene2';
        //<scene>//
        scene2create.call(this);
        //key register//
        keyRegistion.call(this);
        //create character//
        if (mode == 0) player0Creation.call(this,player_checkpoint_x,player_checkpoint_y);//sword player//
         else player1Creation.call(this,player_checkpoint_x,player_checkpoint_y);//arrow player// 
        player.body.setVelocity(0,0);
        
		KeyDoor = this.physics.add.sprite(107,336,'Keys');//key create//
		
		player.body.setVelocity(0,0);
		if (!canMove){
		canMove = true;	
		this.scene.restart();
		}			
        arrows = this.physics.add.group();
		enemies = this.physics.add.group();
		//set up enemy//
		CreateScene2Enemies.call(this,7200,100);
		CreateScene2Enemies.call(this,7270,500);
		CreateScene2Enemies.call(this,6000,470);
		CreateScene2Enemies.call(this,4520,100);
		CreateScene2Enemies.call(this,4620,100);
		
		//Boss
		CreateScene2Enemies.call(this,80,400);
		CreateScene2Enemies.call(this,160,400);
		CreateScene2Enemies.call(this,240,400);
		CreateScene2Enemies.call(this,320,400);
		CreateScene2Enemies.call(this,400,400);
		CreateScene2Enemies.call(this,480,400);
		
		//pointer//
		goTo1 = this.physics.add.sprite(7950, 210, 'red2');
		goTo1.anims.play('portal_A', true);
		this.physics.add.collider(goTo1, platforms);

        this.physics.add.collider(platforms, arrows, arrowHit, null, this);
        this.physics.add.collider(player, arrows , playerHit, null, this);
        this.physics.add.overlap(player, npc0, NPCOverlap, null, this);
        this.physics.add.overlap(player, npc1, NPCOverlap, null, this);
		this.physics.add.overlap(player, goTo1, ChangeScene, null, this);
        
		this.physics.add.collider(platforms, KeyDoor);
		this.physics.add.overlap(player, KeyDoor, function(){		 
		KeyID[0] = true ; KeyDoor.disableBody(true,true);
		}, null, this);
		
		if(KeyID[0]==true)
		{
			KeyDoor.disableBody(true,true);
		}

        this.cameras.main.startFollow(player, true, 0.08, 0.08);

        nomarlText.call(this);
        scene2createcollider.call(this);
		
		playerPosX = 189; playerPosY = 461; //for go back position//
      },

      update: function(){
		//console.log("x"+player.body.x+"y"+player.body.y);
        //player movement//
		
        playerMovement.call(this);
		detectPlayerBlood.call(this);
		

         if (spaceV.isDown && flipFlop1){
          flipFlop1 = false;
          if (speed == 160){
            speed = 80;
          }else {
            speed = 160;
          }
        }
         if(spaceV.isUp && !flipFlop1) {
          flipFlop1 = true;
        }
		
		if(player.body.x<680&&KeyID[0]==true)
		{
			scene2_reached_bossstage=true;
			player_checkpoint_x=200;player_checkpoint_y=300;
		}

      }

    });
	
	var Scene3 = new Phaser.Class({// forest
	  Extends: Phaser.Scene,
      initialize:
      function Scene3 ()//scene2 setting//
      {
        Phaser.Scene.call(this, { key: 'scene3' });
      },
	  preload: function(){		  
        //mode = 0; //1 for arrow ;0 for sword //
		//isChangeScene=false;
        right = false;
        left = false;
		PreLoadScene2Enemies.call(this);
		this.load.image('red','/assets/pointer/red.png');
		this.load.image('tree_bg', 'assets/BG.png');
		this.load.image('try','assets/background/example/Magic-Cliffs-Environment/PNG/ground.png');
		this.load.image('try1','assets/background/example/Magic-Cliffs-Environment/PNG/ground1.png');
        this.load.image('arrow','assets/characters/arrow1.png');
		this.load.image('apple','assets/Scene3/apple.png');
		this.load.spritesheet('monkey_jump','assets/Scene3/sprite_baboonMonkJump.png',
		{ frameWidth: 64, frameHeight: 64 });
		this.load.spritesheet('monkeyR','assets/Scene3/sprite_baboonMonk_right.png',
        { frameWidth: 64, frameHeight: 64 });
		this.load.spritesheet('monkeyL','assets/Scene3/sprite_baboonMonk_left.png',
        { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('player1','assets/characters/playerarmor.png',
        { frameWidth: 64, frameHeight: 64 });//player_swards.png
        this.load.spritesheet('player0','assets/characters/player_swards.png',
        { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('NPCMode','assets/NPCs/NPC.png',
        { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('glowsword','assets/characters/glowsword_red_female.png',
        { frameWidth: 192, frameHeight: 192 });
		//for key//
		this.load.spritesheet('Keys','assets/KeyIcons.png',{frameWidth: 32,frameHeight: 32 });
        //scene3preload.call(this);
		//PreLoadScene2Enemies.call(this);
      },

      create: function(){
	    sceneName = 'scene3';
		scene3pass = false;
		scene3_ctr=0;
		apple_num=5;
		t_3=this.time.now;
		scene3_time=this.time.now;
        //<scene>//
        this.cameras.main.setBounds(0, 0, 2000, 800);
        this.physics.world.setBounds(0, 0, 2000, 800);
		scene3Boss = this.physics.add.group();
		apples = this.physics.add.group();
        platforms = this.physics.add.staticGroup();        		
	    this.add.image(1050, 400, 'tree_bg').setScale(3);//800,500
	
		
	    for(var i =0;i<45;i++ ){
	      platforms.create(i*48,800,'try');
          var image = this.add.image(i*48, 782, 'try1');//grass
          image.depth = image.y;
		  }
          //key register//
          keyRegistion.call(this);
          //create character//
         if (mode == 0) player0Creation.call(this,200,600);//sword player//
         else player1Creation.call(this,200,600);//arrow player//
			
          arrows = this.physics.add.group();
		
		var enemy = this.physics.add.sprite(300,685,'monkeyL').setScale(3);
		enemy.setCollideWorldBounds(true);
		enemy.body.setSize(50,60).setOffset(7,5);

            this.anims.create({
                key: 'monkeyL',
                frames: this.anims.generateFrameNumbers('monkeyL', { start: 0, end: 7 }),
                frameRate: 10,
                repeat: -1
				
            });
			this.anims.create({
                key: 'monkey_jump',
                frames: this.anims.generateFrameNumbers('monkey_jump', { start: 0, end: 0 }),
                frameRate: 10,
                repeat: -1
				
            });
	  this.tweens.timeline({
              targets: enemy.body.velocity,
              loop: -1,
			 
              tweens: [
                       { x: monkey_speed*scene3_lv, y: 0, duration: 1500000/monkey_speed/scene3_lv, ease: 'Stepped',
					   onStart: function(){enemy.flipX = !enemy.flipX;enemy.anims.play('monkeyL',true);jump_b=false;}},		
						{ x: 0, y: -200, duration: 300, ease: 'Stepped',
					   onStart: function(){enemy.anims.play('monkey_jump',true);jump_b=false;}},		
						{ x: 0, y: 200, duration: 300, ease: 'Stepped',
					   onStart: function(){enemy.anims.play('monkey_jump',true);jump_b=true;}},					   
                       { x: monkey_speed*-1*scene3_lv, y: 0, duration: 1500000/monkey_speed/scene3_lv, ease: 'Stepped',
					   onStart: function(){enemy.flipX = !enemy.flipX;enemy.anims.play('monkeyL',true);jump_b=false;}},
						{ x: 0, y: -200, duration: 300, ease: 'Stepped',
					   onStart: function(){enemy.anims.play('monkey_jump',true);jump_b=false;}},		
						{ x: 0, y: 200, duration: 300, ease: 'Stepped',
					   onStart: function(){enemy.anims.play('monkey_jump',true);jump_b=true;}}					   
                      ]
                     });

	  scene3Boss.add(enemy);

		  goTo1 = this.physics.add.sprite(50, 715, 'red2');
		  goTo1.anims.play('portal_A', true);
		  this.physics.add.collider(goTo1, platforms);
          this.physics.add.collider(platforms, arrows, arrowHit, null, this);
          this.physics.add.collider(player, arrows , playerHit, null, this);
		  this.physics.add.overlap(player, apples , playerDemage, null, this);
		  this.physics.add.overlap(player, scene3Boss, scene3_dam, null, this);
		  this.physics.add.overlap(player, goTo1, ChangeScene, null, this);
		  this.physics.add.collider(scene3Boss,platforms);
          this.cameras.main.startFollow(player, true, 0.08, 0.08);

          nomarlText.call(this);
          //scene3createcollider.call(this);
		  playerPosX = 1549; playerPosY = 461; //for go back position//
      },

      update: function(){
		//console.log("x"+player.body.x+"y"+player.body.y);
        //player movement//
        playerMovement.call(this);		
		
		
		detectPlayerBlood.call(this);
		
		if(this.time.now-t_3>apple_time&&scene3pass==false)
		{
		t_3=this.time.now;	
		for(var i=0;i<apple_num;i++)
		{
		apple_p_x=Math.random()*1200+500;
		apple_s_y=Math.random()*59+1;
		apple = this.physics.add.sprite(apple_p_x,100,'apple').setScale(apple_size);
	    apple.setBounce(0);
	    apple.setVelocity(0,apple_s_y);
        apple.setCollideWorldBounds(false);
		apples.add(apple);
		}
		
		}
        //NPCMovement.call(this);//NPC move//
		
         if (spaceV.isDown && flipFlop1){
          flipFlop1 = false;
          if (speed == 160){
            speed = 80;
          }else {
            speed = 160;
          }
        }
         if(spaceV.isUp && !flipFlop1) {
          flipFlop1 = true;
        }

      }
	});

    var Scene4 = new Phaser.Class({//Dragon scene//
      Extends: Phaser.Scene,
      initialize:
      function Scene4 ()//scene2 setting//
      {
        Phaser.Scene.call(this, { key: 'scene4' });
      },

      preload: function(){
        //mode = 0; //1 for arrow ;0 for sword //
		//isChangeScene=false;
        right = false;
        left = false;
		this.load.image('red','/assets/pointer/red.png');
        this.load.image('arrow','assets/characters/arrow1.png');
        this.load.spritesheet('player1','assets/characters/playerarmor.png',
        { frameWidth: 64, frameHeight: 64 });//player_swards.png
        this.load.spritesheet('player0','assets/characters/player_swards.png',
        { frameWidth: 64, frameHeight: 64 });
        this.load.spritesheet('glowsword','assets/characters/glowsword_red_female.png',
        { frameWidth: 192, frameHeight: 192 });
        scene2preload.call(this);
		//preloadscene4//
		this.load.image('Scene4Background','/assets/Scene4/Full-Background.png');
		this.load.image('Scene4ground','/assets/Scene4/Tile.png');
		this.load.image('Scene4castle', 'assets/Scene1/background/oppcastle-mod-tiles (1).png');
        this.load.image('Scene4castledoor', 'assets/Scene1/background/oppcastle-mod-tiles (2).png');
		//boss//
		this.load.spritesheet('Dragon','assets/enemy/reddragonfly.png',
        { frameWidth: 205, frameHeight: 161 });
		this.load.spritesheet('bomb','assets/enemy/bomb_animation.png',
        { frameWidth: 60, frameHeight: 60 });
		this.load.spritesheet('bomb2','assets/enemy/bomb.png',
        { frameWidth: 14, frameHeight: 14 });
		this.load.spritesheet('princess','assets/princess/princess.png',
        { frameWidth: 47.75, frameHeight: 62.5 });
		//talk//
		this.load.image('notice', 'assets/Scene0/background/Notitz.png');
		this.load.bitmapFont('nokia', 'assets/Scene0/font/nokia16black.png', 'assets/Scene0/font/nokia16black.xml');
		musicPreLoad.call(this);
      },

      create: function(){
	    musicCreation.call(this);
	    bossAct = -2;
		bosssuperpower=2;
	    sceneName = 'scene4';
		//scene4 space setting// 
		this.cameras.main.setBounds(0, 0, 1200, 768);
        this.physics.world.setBounds(0, 0, 1200, 768);
	    platforms = this.physics.add.staticGroup();		
        //<scene4>//		
		this.add.image(768,384, 'Scene4Background').setScale(0.5);//create background//	
        for(var i=0;i<8;i++){
		  platforms.create(205*i,790,'Scene4ground');//create ground//
		}
		
		//set up princess//
		princess = this.physics.add.sprite(720,360,'princess');
		princess.body.setAllowGravity(false);
		//talk setup//
	    notices[0] = this.add.image(720,360-50,'notice');
	    textBox[0] = this.add.bitmapText(680, 360-75, 'nokia', 'save me!', 15);
	    notices[0].setScale(1,0.3);
	    notices[0].alpha = 0;
	    textBox[0].alpha = 0;
		notices[1] = this.add.image(821,300-50,'notice');
	    textBox[1] = this.add.bitmapText(781, 300-75, 'nokia', 'Dragon!', 15);
	    notices[1].setScale(1,0.3);
	    notices[1].alpha = 0;
	    textBox[1].alpha = 0;
		this.add.image(900, 632, 'Scene4castledoor').setScale(1.4,1);
		this.add.image(860, 522, 'Scene4castle').setScale(2.5);


		
        //key register//
        keyRegistion.call(this);
        //create character//
         if (mode == 0) player0Creation.call(this,100,100);//sword player//
         else player1Creation.call(this,100,100);//arrow player// 
        player.body.setBounce(0);       		
        arrows = this.physics.add.group();
		enemies = this.physics.add.group();	
        bossenable = this.physics.add.sprite(618,628,'arrow').setAngle(90);		
        

		bossCreation.call(this,3,750,300);//set up enemy//
		

        //collision setup//
        this.physics.add.collider(platforms, arrows, arrowHit, null, this);
        this.physics.add.collider(player, arrows , playerHit, null, this);		
		this.physics.add.collider(platforms, bossenable);
        this.physics.add.collider(player, bossenable,function(){
		  bossenable.destroy();
		  bossAct = 0;
		},null,this);		
        this.cameras.main.startFollow(player, true, 0.08, 0.08);
        nomarlText.call(this);
      },

      update: function(){
		        
		if (playingState==0) playerMovement.call(this);
		else {
		  cursors.right.isDown = false;
		  cursors.left.isDown = false;
		  cursors.up.isDown = false;
		  player.body.setVelocity(0,40);
		  model.anims.play('turn');
		}
		detectPlayerBlood.call(this);

		bossUpdate.call(this,3);//for boss action//
		

         if (spaceV.isDown && flipFlop1){
          flipFlop1 = false;
          if (speed == 160){
            speed = 80;
          }else {
            speed = 160;
          }
        }
         if(spaceV.isUp && !flipFlop1) {
          flipFlop1 = true;
        }

      }

    });

    var SceneC = new Phaser.Class({//for meun//

      Extends: Phaser.Scene,

      initialize:

      function SceneC (){
        Phaser.Scene.call(this, { key: 'sceneC' });
      },

    preload: function (){
        this.load.spritesheet('button', 'assets/UI/flixel-button.png', { frameWidth: 80, frameHeight: 20 });
		this.load.image('BGM', 'assets/sky.png');
        this.load.bitmapFont('nokia', 'assets/UI/nokia16black.png', 'assets/UI/nokia16black.xml');

        this.load.audioSprite('buttonsound', 'assets/audio/fx_mixdown.json', [
            'assets/audio/fx_mixdown.ogg',
            'assets/audio/fx_mixdown.mp3'
          ]);
        this.load.spritesheet('heart', 'assets/characters/heart.png', { frameWidth: 48, frameHeight: 48 });		  
		
		//talk//
		this.load.image('notice', 'assets/Scene0/background/Notitz.png');
		this.load.bitmapFont('nokia', 'assets/Scene0/font/nokia16black.png', 'assets/Scene0/font/nokia16black.xml');
		this.load.spritesheet('Dragon','assets/enemy/reddragonfly.png',
        { frameWidth: 205, frameHeight: 161 });
		musicPreLoad.call(this);
    },

    create: function (){
	 this.add.image(100,100,'BGM');
	  musicCreation.call(this);
	  
	  DragonC = this.physics.add.sprite(100,120,'Dragon');
	  DragonC.body.allowGravity = false;
	  
	 var Title =  this.add.text(250, 16, 'My hero VS Dragon', { fontSize: '32px', color: '#00CC00' });
     //talk setup//
	    notices[0] = this.add.image(350,400,'notice').setScale(3,1);
	    textBox[0] = this.add.bitmapText(230-40, 320,'nokia', 
		'\nThere was a princess who was caught \n\nby an evil dragon. A hero wanted to \n\nsave her. \n\nThe adventure was started.',
		16);
	  
	  //scoreText = this.add.text(16, 16, 'Button: ', { fontSize: '16px', color: '#ff0000' });
     var spritemap = this.cache.json.get('buttonsound').spritemap;
	  resetData();
      if(playingState==0) makeButton.call(this,'Start New Game',400,200);
	  else if(playingState == 1){
	    this.add.text(320, 120, 'YOU LOSE!', { fontSize: '32px', color: '#ff0000' });
		this.add.text(320, 150, 'You Die: '+DIETime, { fontSize: '32px', color: '#ff00ff' });
	    makeButton.call(this,'Start New Game',400,200);
	    makeButton.call(this,'Continues',400,250);
		playingState = 0;
	  }
	  else if (playingState == 2){
	    this.add.text(330, 120, 'YOU WIN!', { fontSize: '32px', color: '#ff0000' });
		this.add.text(320, 150, 'You Die: '+(DIETime-1), { fontSize: '32px', color: '#ff00ff' });
	    makeButton.call(this,'Start New Game',400,200);
		playingState = 0;
	  }
       makephysicsbutton.call(this,'drag me',5,5);

       this.input.setDraggable(container);
       this.physics.world.enable(container);
       container.body.setVelocity(100, 100).setBounce(1, 1).setCollideWorldBounds(true);

       this.input.on('dragstart', function (pointer, obj)
       {
           obj.body.moves = false;
       });

       this.input.on('drag', function (pointer, obj, dragX, dragY)
       {
           obj.setPosition(dragX, dragY);
		   //scoreText.setText('Dragging me');
       });

       this.input.on('dragend', function (pointer, obj)
       {
           obj.body.moves = true;
		   //scoreText.setText('Button: ');
       });


       this.input.on('gameobjectover', function (pointer, button)
       {
           this.sound.playAudioSprite('buttonsound', 'numkey');
           setButtonFrame(button, 0);
       },this);
       this.input.on('gameobjectout', function (pointer, button)
       {
           setButtonFrame(button, 1);
       });
       this.input.on('gameobjectdown', function (pointer, button)
       {
           this.sound.playAudioSprite('buttonsound', 'alien death');
           if(button.name == 'Start New Game'){
		     KeyID = [false,false];
			 DIETime=0;
			 resetData();
			 scene2_reload=false;
             this.scene.start('scene0');
           }
		   if(button.name == 'Continues'){
		     if (sceneName=='secen4'){
			    sceneName = 'secen1';
			 }
			 if(sceneName=='scene2')
			 {
				scene2_reload=true;
			 }
             this.scene.start(sceneName);
           }
           setButtonFrame(button, 2);

       }, this);
       this.input.on('gameobjectup', function (pointer, button)
       {
           setButtonFrame(button, 0);
       });	  
	   this.anims.create({
                key: 'boss3right',
                frames: this.anims.generateFrameNumbers('Dragon', { start: 0, end: 7 }),
                frameRate: 10,
                repeat: -1
            });
	  
	  this.tweens.timeline({
         targets: DragonC.body.velocity,
         loop: -1,
         tweens: [
                { x: 50, y: 0, duration: 8000, ease: 'Stepped', 
					   onStart: function(){DragonC.flipX = false;DragonC.anims.play('boss3right',true);} },
                 { x: -50, y: 0, duration: 8000, ease: 'Stepped', 
					   onStart: function(){DragonC.flipX = true;DragonC.anims.play('boss3right',true);}}					   
                 ]});		
  },

    update: function(){
   }

});

    function createcandle(x,y){
      this.anims.create({
      key: 'candle',
      frames: [
        { key: 'candle1' },
        { key: 'candle2' },
        { key: 'candle3' },
        { key: 'candle4' }
      ],
      frameRate: 10,
      repeat: -1
     });

       this.add.image(x,y,'candle0').setScale(1.5);
       this.add.sprite(x-24, y-40, 'candle1').setScale(2).play('candle');
       this.add.sprite(x, y-46, 'candle1').setScale(2).play('candle');
       this.add.sprite(x+21, y-40, 'candle1').setScale(2).play('candle');
       //this.add.sprite(x, y, 'candle1').play('candle');
      //this.add.sprite(x, y, 'candle1').play('candle');
    }

    function scene0createcollider(){
      this.physics.add.collider(arrows,dummy);
	  this.physics.add.collider(platforms,dummy);
	  //this.physics.add.collider();
    }

    function scene1preload(){
      this.load.image('background sky', 'assets/Scene1/background/sky.png');
      this.load.image('ground', 'assets/Scene1/background/ground.png');
      this.load.image('ground1', 'assets/Scene1/background/ground1.png');
      this.load.image('castle', 'assets/Scene1/background/oppcastle-mod-tiles (1).png');
      this.load.image('castle door', 'assets/Scene1/background/oppcastle-mod-tiles (2).png');
      this.load.image('plane', 'assets/Scene1/background/clipart2329426.png');
      this.load.image('helicopter', 'assets/Scene1/background/helicol.png');
      this.load.image('sign', 'assets/Scene1/background/signpost.png');
      this.load.bitmapFont('nokia', 'assets/Scene1/font/nokia16black.png', 'assets/Scene1/font/nokia16black.xml');
      this.load.image('tree', 'assets/Scene1/background/tileset.png');
      this.load.image('rock1', 'assets/Scene1/background/tileset (1).png');
      this.load.image('rock2', 'assets/Scene1/background/tileset (2).png');
      this.load.image('rock3', 'assets/Scene1/background/tileset (3).png');
    }

    function scene1create(){
		this.cameras.main.setBounds(0, 0, 1800, 600);
      this.physics.world.setBounds(0, 0, 1800, 600);
	    platforms = this.physics.add.staticGroup();

	    let image = this.add.image(this.cameras.main.width / 2, this.cameras.main.height / 2, 'background sky');
	    let scaleX = this.cameras.main.width / image.width;
	    let scaleY = this.cameras.main.height / image.height;
	    let scale = Math.max(scaleX, scaleY);
	    image.setScale(scale);

	    this.add.image(this.cameras.main.width*2, this.cameras.main.height / 2, 'background sky').setScale(scale).setFlip(true, false);

	    //add tree
		  this.add.image(1700, 352, 'tree').setScale(3);
		  this.add.image(1650, 352, 'tree').setScale(3);

	    //add rocks
			this.add.image(20, 500, 'rock1').setScale(2.5);
			this.add.image(90, 500, 'rock2').setScale(2);
			this.add.image(160, 500, 'rock3').setScale(2.5);

	    //create ground
	    for(let i =0;i<60;i++ ){
	      platforms.create(i*48,535,'ground');
		   }
		   //create castle
		   this.add.image(900, 470, 'castle door').setScale(1.4,1);
		   this.add.image(860, 360, 'castle').setScale(2.5);




		 //create grass
		 for(let i =0;i<30;i++ ){
			let ground = this.add.image(Math.floor(Math.random()*Math.floor(1800)), 520, 'ground1').setScale(2);//grass

		  }

		 //create plane
		  this.add.image(1390, 470, 'plane').setScale(0.3);

		  //create helicopter
		  this.add.image(390, 468, 'helicopter').setScale(2.3);

		  //create sign
		  sign=this.add.image(160, 480, 'sign').setScale(2.5);
		  text=this.add.bitmapText(160-18, 480-25, 'nokia', 'cliff', 20);
			text.x += (sign.width - text.width) / 2;

		  sign=this.add.image(1600, 480, 'sign').setScale(2.5);
		  text=this.add.bitmapText(1600-18, 480-25, 'nokia', 'forest', 20);
			text.x += (sign.width - text.width) / 2;

	  }

    function scene1createcollider(){	
	  this.physics.add.collider(player, enemies, playerDemage, null, this);

    }

	function scene2preload(){
		this.load.image('background sky', 'assets/Scene2/background/sky.png');

		this.load.image('ground', 'assets/Scene2/background/ground.png');
		this.load.image('ground1', 'assets/Scene2/background/ground1.png');
		this.load.image('cloud', 'assets/Scene2/background/clouds.png');
		this.load.image('sea', 'assets/Scene2/background/sea.png');
		this.load.bitmapFont('nokia', 'assets/Scene2/font/nokia16black.png', 'assets/scene2/font/nokia16black.xml');
		this.load.image('tree', 'assets/Scene2/background/tileset.png');
		this.load.image('rock1', 'assets/Scene2/background/tileset (1).png');
		this.load.image('rock2', 'assets/Scene2/background/tileset (2).png');
		this.load.image('rock3', 'assets/Scene2/background/tileset (3).png');
		this.load.image('tileset_0001_Layer', 'assets/Scene2/background//photoshop/tileset_0001_Layer-2.png');
		this.load.image('tileset_0002_Layer', 'assets/Scene2/background//photoshop/tileset_0002_Layer-3.png');
		this.load.image('tileset_0003_Layer', 'assets/Scene2/background//photoshop/tileset_0003_Layer-4.png');
		this.load.image('tileset_0004_Layer', 'assets/Scene2/background//photoshop/tileset_0004_Layer-5.png');
		this.load.image('tileset_0005_Layer', 'assets/Scene2/background//photoshop/tileset_0005_Layer-6.png');
		this.load.image('tileset_0006_Layer', 'assets/Scene2/background//photoshop/tileset_0006_Layer-7.png');
		this.load.image('tileset_0007_Layer', 'assets/Scene2/background//photoshop/tileset_0007_Layer-8.png');
		this.load.image('tileset_0008_Layer', 'assets/Scene2/background//photoshop/tileset_0008_Layer-9.png');
		this.load.image('tileset_0009_Layer', 'assets/Scene2/background//photoshop/tileset_0009_Layer-10.png');
		this.load.image('tileset_0010_Layer', 'assets/Scene2/background//photoshop/tileset_0010_Layer-11.png');
		this.load.image('tileset_0011_Layer', 'assets/Scene2/background//photoshop/tileset_0011_Layer-12.png');
		this.load.image('tileset_0012_Layer', 'assets/Scene2/background//photoshop/tileset_0012_Layer-13.png');
		this.load.image('skeleton', 'assets/Scene2/background/Deco_skeleto_sitdown.png');
	}

    function scene2create(){
	  if(scene2_reload==false)
		{
			player_checkpoint_x=7800;player_checkpoint_y=200;
		}
      this.cameras.main.setBounds(0, 0, 8000, 600);
      this.physics.world.setBounds(0, 0, 8000, 600);
	  platforms = this.physics.add.staticGroup();

	  //create sky
	  for(let i=0;i<120;i++)
	  {
	  let scale=1.25;
	  this.add.image(56*i*scale,152*scale, 'background sky').setScale(scale);
	  }
	 //create sea
	  for(let i=0;i<70;i++)
	  {
	   let scale=2.3;
	  this.add.image(56*i*scale,490, 'sea').setScale(scale);
	  }
	  //create cloud
	  for(let i=0,k=0;i<40;i++,k+=272*2)
	  {
	   let scale=1;
	  this.add.image((272+k)*scale,262*scale, 'cloud').setScale(scale);
	  }

	  //create platform
		platforms.create(7600,400,'tileset_0001_Layer').setScale(2.5).refreshBody();
		for(let i=0,k=0;i<10;i++,k+=40)
	  {
	   let scale=2.5;
	  platforms.create((7694+k),400,'tileset_0003_Layer').setScale(scale).refreshBody();
	  }

	  //create skeleton
	  this.add.image(7650,265, 'skeleton').setScale(0.7,0.6);

	  //create platform
	   platforms.create(7430,630,'tileset_0009_Layer').setFlip(true,false).setScale(2.5).refreshBody().setSize(205,240,true).setOffset(0,40);
		 platforms.create(7200,630,'tileset_0009_Layer').setScale(2.5).refreshBody().setSize(205,240,true).setOffset(20,40);
		 platforms.create(7500,400,'rock1').setScale(2).refreshBody();

	  //create platform
	  platforms.create(7180,180,'tileset_0001_Layer').setScale(2.5,1).refreshBody();
	  platforms.create((7274),180,'tileset_0003_Layer').setScale(2.5,1).refreshBody();
	  platforms.create(7368,180,'tileset_0002_Layer').setScale(2.5,1).refreshBody();

	  //create platform
	  platforms.create(6900,470,'tileset_0008_Layer').setScale(2.5).refreshBody().setSize(200,160,true).setOffset(30,10);



	 //move platforms

	 move_platforms = this.physics.add.group();
	 
	 createmoveplatform.call(this,6280,300,'rock2',[
      { x:   150, y: 0, duration: 3000, ease: 'Stepped' },
	  { x:   0, y: 0, duration: 1000, ease: 'Stepped' },
      { x:  -150, y:  -0, duration: 3000, ease: 'Stepped' },
	  { x:   0, y: 0, duration: 1000, ease: 'Stepped' }
    ],2);
	
	
	 createmoveplatform.call(this,6500,500,'rock1',[
      { x:   0, y: -150, duration: 3000, ease: 'Stepped' },
      { x:   0, y: 150, duration: 3000, ease: 'Stepped' }
    ],2);

	
	  platforms.create(6100,570,'tileset_0008_Layer').setScale(2.5).refreshBody().setSize(200,160,true).setOffset(30,10);


	
	 createmoveplatform.call(this,5500,400,'rock2',[
      { x:   200, y: 0, duration: 2000, ease: 'Stepped' },
	  { x:   0, y: -200, duration: 1000, ease: 'Stepped' },
      { x:  -200, y:  0, duration: 2000, ease: 'Stepped' },
	  { x:   0, y: 200, duration: 1000, ease: 'Stepped' }
    ],2);
	
	createmoveplatform.call(this,5700,250,'rock2',[
      { x:   -200, y: 0, duration: 2000, ease: 'Stepped' },
	  { x:   0, y: 200, duration: 1000, ease: 'Stepped' },
      { x:  200, y:  0, duration: 2000, ease: 'Stepped' },
	  { x:   0, y: -200, duration: 1000, ease: 'Stepped' }
    ],2);

     createmoveplatform.call(this,5000,250,'rock2',[
      { x:   200, y: 0, duration: 2000, ease: 'Stepped' },
	  { x:   -150, y: 200, duration: 1000, ease: 'Stepped' },
      { x:  -200, y:  0, duration: 2000, ease: 'Stepped' },
	  { x:   150, y: -200, duration: 1000, ease: 'Stepped' }
    ],2);

	createmoveplatform.call(this,5150,50,'rock1',[
	  { x:   0, y: 700, duration: 450, ease: 'Stepped' },
	  { x:   0, y: -700, duration: 450, ease: 'Stepped' }
    ],2);
	
    platforms.create(5200,500,'rock3').setScale(2).refreshBody().setSize(90,60,true).setOffset(8,20);
	
	platforms.create(4580,180,'tileset_0001_Layer').setScale(2.5,1).refreshBody();
	  platforms.create((4674),180,'tileset_0003_Layer').setScale(2.5,1).refreshBody();
	  platforms.create(4768,180,'tileset_0002_Layer').setScale(2.5,1).refreshBody();

	 createmoveplatform.call(this,3980,120,'rock1',[
	  { x:   500, y: 0, duration: 1000, ease: 'Stepped' },
	  { x:   -500, y: 0, duration: 1000, ease: 'Stepped' }
    ],2);
	createmoveplatform.call(this,3980,260,'rock1',[
	  { x:   500, y: 0, duration: 1000, ease: 'Stepped' },
	  { x:   -500, y: 0, duration: 1000, ease: 'Stepped' }
    ],2);
	createmoveplatform.call(this,3980,400,'rock1',[
	  { x:   500, y: 0, duration: 1000, ease: 'Stepped' },
	  { x:   -500, y: 0, duration: 1000, ease: 'Stepped' }
    ],2);
	createmoveplatform.call(this,3980,540,'rock1',[
	  { x:   500, y: 0, duration: 1000, ease: 'Stepped' },
	  { x:   -500, y: 0, duration: 1000, ease: 'Stepped' }
    ],2);
	
	createmoveplatform.call(this,4400,100,'rock1',[
	  { x:   0, y: 500, duration: 1000, ease: 'Stepped' },
	  { x:   0, y: -500, duration: 1000, ease: 'Stepped' }
    ],2);
	createmoveplatform.call(this,4260,100,'rock1',[
	  { x:   0, y: 500, duration: 1000, ease: 'Stepped' },
	  { x:   0, y: -500, duration: 1000, ease: 'Stepped' }
    ],2);
	createmoveplatform.call(this,4120,100,'rock1',[
	  { x:   0, y: 500, duration: 1000, ease: 'Stepped' },
	  { x:   0, y: -500, duration: 1000, ease: 'Stepped' }
    ],2);
	createmoveplatform.call(this,3980,100,'rock1',[
	  { x:   0, y: 500, duration: 1000, ease: 'Stepped' },
	  { x:   0, y: -500, duration: 1000, ease: 'Stepped' }
    ],2);

	platforms.create(3600,300,'rock3').setScale(2).refreshBody().setSize(90,60,true).setOffset(8,20);
 
	createmoveplatform.call(this,3500,50,'rock1',[
	  { x:   -300, y: 200, duration: 1500, ease: 'Stepped' },
	  { x:   300, y: -200, duration: 1500, ease: 'Stepped' }
    ],2);
	createmoveplatform.call(this,3500,190,'rock1',[
	 { x:   -300, y: 200, duration: 1500, ease: 'Stepped' },
	  { x:   300, y: -200, duration: 1500, ease: 'Stepped' }
    ],2);
	createmoveplatform.call(this,3500,330,'rock1',[
	 { x:   -300, y: 200, duration: 1500, ease: 'Stepped' },
	  { x:   300, y: -200, duration: 1500, ease: 'Stepped' }
    ],2);
	createmoveplatform.call(this,3500,470,'rock1',[
	   { x:   -300, y: 200, duration: 1500, ease: 'Stepped' },
	  { x:   300, y: -200, duration: 1500, ease: 'Stepped' }
    ],2);
	
	createmoveplatform.call(this,3275,300,'rock2',[
      { x:   0, y: 150, duration: 1000, ease: 'Stepped' },
	  { x:   0, y: -150, duration: 1000, ease: 'Stepped' }
    ],2)
	
	createmoveplatform.call(this,3050,50,'rock1',[
	  { x:   300, y: 200, duration: 1500, ease: 'Stepped' },
	  { x:   -300, y: -200, duration: 1500, ease: 'Stepped' }
    ],2);
	createmoveplatform.call(this,3050,190,'rock1',[
	  { x:   300, y: 200, duration: 1500, ease: 'Stepped' },
	  { x:   -300, y: -200, duration: 1500, ease: 'Stepped' }
    ],2);
	createmoveplatform.call(this,3050,330,'rock1',[
	 { x:   300, y: 200, duration: 1500, ease: 'Stepped' },
	  { x:   -300, y: -200, duration: 1500, ease: 'Stepped' }
    ],2);
	createmoveplatform.call(this,3050,470,'rock1',[
	  { x:   300, y: 200, duration: 1500, ease: 'Stepped' },
	  { x:   -300, y: -200, duration: 1500, ease: 'Stepped' }
    ],2);
 
	platforms.create(2800,570,'tileset_0008_Layer').setScale(2.5).refreshBody().setSize(200,160,true).setOffset(30,10);
	
	//create falling platform
	this.fall_platform=[];
	
	
	
	platforms.create(2350,450,'rock3').setScale(2).refreshBody().setSize(90,60,true).setOffset(8,20);
	
	
	createmoveplatform.call(this,1050,-100,'rock1',[
	 { x:   0, y: 0, duration: 1200, ease: 'Stepped' },
	  { x:   0, y: 3000, duration: 300, ease: 'Stepped' }
    ],2);
	
	
	if(scene2_reached_bossstage==false)
	{
		this.fall_platform.push(this.add.sprite(2450,400,'rock2').setScale(2));
		this.fall_platform.push(this.add.sprite(2000,450,'rock1').setScale(2));
	this.fall_platform.push(this.add.sprite(1600,450,'rock1').setScale(2));
	this.fall_platform.push(this.add.sprite(1200,450,'rock1').setScale(2));
	this.fall_platform.push(this.add.sprite(900,450,'rock1').setScale(2));
	}
	
	createmoveplatform.call(this,-50,250,'rock1',[
	 { x:   0, y: 0, duration: 3000, ease: 'Stepped' },
	  { x:   6000, y: 0, duration: 470, ease: 'Stepped' }
    ],2);
	
	platforms.create(100,300,'rock3').setScale(2).refreshBody().setSize(90,60,true).setOffset(8,20);
	
	this.bossstage = this.physics.add.staticGroup();
	  platforms.create(600,500,'tileset_0008_Layer').setScale(2.5).refreshBody().setSize(200,160,true).setOffset(30,10);
	  platforms.create(500,455,'tileset_0007_Layer').setScale(2.5).refreshBody();
	  
	 platforms.create(450,455,'tileset_0006_Layer').setScale(2.5).refreshBody();
	  platforms.create(410,455,'tileset_0006_Layer').setScale(2.5).refreshBody();
	  platforms.create(370,455,'tileset_0006_Layer').setScale(2.5).refreshBody();

		platforms.create(310,455,'tileset_0005_Layer').setScale(2.5).refreshBody();
		platforms.create(210,500,'tileset_0008_Layer').setFlip(true, false).setScale(2.5).refreshBody().setSize(200,160,true).setOffset(20,10);

	
	}

	function scene2createcollider(){
		//enemy attack player//
		enemiesAttack = this.physics.add.group({allowGravity: false});
		this.physics.add.collider(player,enemiesAttack,enemy2Demage,null,this);
		//player on collide with bottom boundary
		player.body.onWorldBounds = true
		this.physics.world.on('worldbounds', function(body, blockedUp, blockedDown, blockedLeft, blockedRight){
			if(blockedDown)
			{

				if(scene2_reached_bossstage==false)
				{
					if(player.body.x>6900&&player.body.x<=8000)
					{
						player.body.x=7800;player.body.y=200;
					}
					else if(player.body.x>6000&&player.body.x<=6900)
					{
						player.body.x=6850;player.body.y=300;
					}
					else if(player.body.x>4600&&player.body.x<=6000)
					{
						player.body.x=6050;player.body.y=400;
					}
					else if(player.body.x>3500&&player.body.x<=4600)
					{
						player.body.x=4650;player.body.y=50;
					}
					else if(player.body.x>2800&&player.body.x<=3500)
					{
						player.body.x=3570;player.body.y=200;
					}
					else if(player.body.x<=2800)
					{
						player.body.x=2800;player.body.y=400;
					}
					for(let i=0;i<this.fall_platform.length;i++)
					{
						if(this.fall_platform[i].collided==true)
						{
							this.fall_platform[i]=this.add.sprite(this.fall_platform[i].x123,this.fall_platform[i].y123,i==0?'rock2':'rock1').setScale(2);
							this.fall_platform[i].collided=false;
							this.physics.world.enable(this.fall_platform[i]);
							this.fall_platform[i].x123=this.fall_platform[i].body.x;
							this.fall_platform[i].y123=this.fall_platform[i].body.y;
							this.fall_platform[i].body.setAllowGravity(false).setImmovable(true);
							this.fall_platform[i].body.setSize(this.fall_platform[i].width,this.fall_platform[i].height,true);
							this.physics.add.collider(player, this.fall_platform[i], scene2_platform_falling, null, this);
						}
						//console.log(this.fall_platform[i].x);
					}
					player_checkpoint_x=7800;player_checkpoint_y=200;
				}
				else
				{
					//if reached boss stage
					if(player.body.x>6900&&player.body.x<=8000)
					{
						player.body.x=6900;player.body.y=300;
					}
					else if(player.body.x>6000&&player.body.x<=6900)
					{
						player.body.x=6100;player.body.y=400;
					}
					else if(player.body.x>4750&&player.body.x<=6000)
					{
						player.body.x=4650;player.body.y=50;
					}
					else if(player.body.x>3700&&player.body.x<=4750)
					{
						player.body.x=3570;player.body.y=200;
					}
					else if(player.body.x>2800&&player.body.x<=3700)
					{
						player.body.x=2800;player.body.y=400;
					}
					else if(player.body.x<=2800)
					{
						player.body.x=200;player.body.y=300;
					}
					player_checkpoint_x=200;player_checkpoint_y=300;
				}
				playerBlood-=10;
				textBlood.setText("PlayerBlood: "+playerBlood);	  
			}
		}, this);

		//player on collide with move platforms
		this.physics.add.collider(player, move_platforms);
		
		//player on collide with fall platforms
		for(let i=0;i<this.fall_platform.length;i++)
		{
			this.fall_platform[i].collided=false;
			this.physics.world.enable(this.fall_platform[i]);
			this.fall_platform[i].x123=this.fall_platform[i].body.x;
			this.fall_platform[i].y123=this.fall_platform[i].body.y;
			//console.log(this.fall_platform[i].x);
			this.fall_platform[i].body.setAllowGravity(false).setImmovable(true);
			this.fall_platform[i].body.setSize(this.fall_platform[i].width,this.fall_platform[i].height,true);
			this.physics.add.collider(player, this.fall_platform[i], scene2_platform_falling, null, this);
		}
		
		//player on collide with bossstage
		this.physics.add.collider(player, this.bossstage, function(){ 
		    	  scene2_reached_bossstage=true;},null, this);
			
		this.physics.add.overlap(player,enemies, enemies2Overlap, null, this);	
	}
	
	function scene2_platform_falling(obj1,obj2){
      if(obj2.collided==false)
		{
			this.tweens.timeline({
				targets: obj2.body.velocity,
				tweens: [
				  { x:   0, y: 0, duration: 600, ease: 'Stepped' },
				  { x:   50, y: 0, duration: 200, ease: 'Stepped' },
				  { x:   -100, y: 0, duration: 200, ease: 'Stepped' },
				  { x:   100, y: 0, duration: 200, ease: 'Stepped' },
				  { x:   -100, y: 0, duration: 200, ease: 'Stepped' },
				  { x:   100, y: 0, duration: 200, ease: 'Stepped' },
				  { x:   -50, y: 0, duration: 200, ease: 'Stepped' },
				  { x:   0, y: 500, duration: 1000, ease: 'Stepped' }
				]
			  });
			  obj2.collided=true;
		}
	}

	function createmoveplatform(x,y,sprite,tween,scale=1,Vx=100,Vy=-100){//for two
		let move_platform=move_platforms.create(x,y,sprite).setImmovable(true).setScale(scale);
		let that=this;
		move_platform.body.setAllowGravity(false);
		this.tweens.timeline({
		targets: move_platform.body.velocity,
		loop: -1,
		onLoop: function(){move_platform.enableBody(true,x,y);},
		tweens: tween
	  });
	}

    function playerMovement(){
	  
	  if(spacebar.isDown && canMove){
	  this.sound.playAudioSprite('sfx1','shot');//soundevent//
      if (mode == 0) timedEvent = this.time.delayedCall(500,onSword,[],this);
      else timedEvent = this.time.delayedCall(1300,onArrow,[],this);
       canMove = false;
     }
     else if (cursors.left.isDown && canMove)
         {
             player.body.setVelocityX(-speed);
             left = true;
             right = false;
			 wordsSetting = 'Direction: left';
             model.anims.play('left', true);
         }
     else if (cursors.right.isDown && canMove)
         {
             player.body.setVelocityX(speed);
             left = false;
             right = true;
			 wordsSetting = 'Direction: right';
             model.anims.play('right', true);
         }
     else if(canMove){
             player.body.setVelocityX(0);
             model.anims.play('turn');
      }
	  else{  player.body.setVelocityX(0); }
	  
	  if (canMove){
	     if (mode == 0 ){
               swords.anims.play('stay');
               swords.alpha = 0;               
             }
	  }
      //attracks//
      if(!canMove && right){
        if (mode == 1){
          arrowspeed = 800;
          arrowAngle[0] = 5;
          arrowAngle[1] = 45;
        }
        else {
          swords.alpha = 1;
          swords.flipX = false;
          swords.anims.play('swordsRight',true);
        }
        model.anims.play('attrackright',true);

      }
      else if(!canMove && left){
        if (mode == 1) {
          arrowspeed = -800;
          arrowAngle[0] = 175;
          arrowAngle[1] = 135;
        }
        else {
          swords.alpha = 1;
          swords.flipX = true;
          swords.anims.play('swordsRight',true);
        }
        model.anims.play('attrackleft',true);
      }
      //jump//
      if (cursors.up.isDown && player.body.touching.down && canMove){
          player.body.setVelocityY(-320);
          this.sound.playAudioSprite('sfx', 'jump');
      }
	  
	  	  if (spaceM.isDown && pressOnce0){
  		    pressOnce0 = false;
  		    if (music.mute){
  		      music.setMute(false);
  		    }else {
  		      music.setMute(true);
  		    }
  		  }
  	     if(spaceM.isUp && !pressOnce0) {
  	    	pressOnce0 = true;
  		  }
	  	  	  
	  updatetextSetting.call(this);	  

    }

    function NPCCreation(x,y){
      //npc0//
      npc0 = this.physics.add.sprite(x, y, 'NPCMode');
      npc0.body.setSize(39,58,(0,2));

      this.anims.create({
          key: 'Turn',
          frames: this.anims.generateFrameNumbers('NPCMode', { start: 55, end: 62 }),
          frameRate: 10,
          repeat: -1
      });

      this.anims.create({
          key: 'talk',
          frames: this.anims.generateFrameNumbers('NPCMode', { start: 47, end: 54 }),
          frameRate: 10,
          repeat: -1
      });

      this.physics.add.collider(npc0, platforms);

      //npc1//
      npc1 = this.physics.add.sprite(x+100, y, 'NPCMode');
      //npc1.setCollideWorldBounds(true);
      npc1.body.setSize(39,58,(0,2));

      this.physics.add.collider(npc1, platforms);
    }

    function NPCMovement(){
      npc0.anims.play('Turn',true);
      npc1.anims.play('Turn',true);
    }

    function NPCOverlap(player,npc){		
      if(npc == npc0){
	    if(talkState[0] == 0)  NPCSpeak("Press \"T\" to \ntalk.",0);
	    else if(talkState[0]==1) NPCSpeak("Go to the Cliffs\nand find \na Key.",0);
		else if (talkState[0]==2 && KeyID[0]) NPCSpeak("You have \na key!",0);
		else if (talkState[0]==2) NPCSpeak("No Key \n no talk!",0);	
        else if (talkState[0]==3 && KeyID[0]) {
		  NPCSpeak("Go to save \nthe princess. ",0);
		  goTo4[0] = this.physics.add.sprite(350,450,'red2');
		  goTo4[0].anims.play('portal_A', true);
          this.physics.add.collider(goTo4[0], platforms);
          this.physics.add.overlap(player, goTo4[0], ChangeScene, null, this);	
		}		
        else if (talkState[0]==2) NPCSpeak("go away",0);		
         npc0D = true;		
	  }
      else if(npc == npc1){
	    if(talkState[1]==0) NPCSpeak("Press \"T\" to \ntalk.",1);
		else if (talkState[1]==1) NPCSpeak("Go to the forest\nand find \na Key.",1);
		else if(talkState[1]==2 && KeyID[1]) NPCSpeak("You have \na key!",1);
		else if(talkState[1]==2) NPCSpeak("Good Luck!",1);
		else if(talkState[1]==3 && KeyID[1]) {
		  NPCSpeak("Go to save \nthe princess.",1);
		  goTo4[1] = this.physics.add.sprite(1350, 450,'red2');
		  goTo4[1].anims.play('portal_A', true);
          this.physics.add.collider(goTo4[1], platforms);
          this.physics.add.overlap(player, goTo4[1], ChangeScene, null, this);
		}
        npc1D = true;
	  }	  
      npc.anims.play('talk',true);

    }

    function arrowHit(platforms,arrow){
      arrow.setVelocity(0,0);
      arrow.angle=(arrowAngle[1]);
    }

    function onArrow(){

      canMove = true;
      var arrow = arrows.create( player.body.x + 50, player.body.y + 35 , 'arrow' );
      arrow.setCollideWorldBounds(true);
      arrow.setAngle(arrowAngle[0]);
      arrow.setVelocity(arrowspeed,1);
    }

    function onSword() {
	  attackingArea.call(this);
      canMove = true;	  
    }

    function keyRegistion(){
        //key register//
		spaceM = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.M);
        spacebar = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
        spaceV = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.V);
        spaceT = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.T);//for talk with NPC//
        //cursors = this.input.keyboard.createCursorKeys();
        cursors = this.input.keyboard.addKeys(
               { up:Phaser.Input.Keyboard.KeyCodes.W,
                 down:Phaser.Input.Keyboard.KeyCodes.S,
                 left:Phaser.Input.Keyboard.KeyCodes.A,
                 right:Phaser.Input.Keyboard.KeyCodes.D});
    }

    function player0Creation(x,y){//sowrd//
      playerDieTime = this.time.addEvent({ delay: 2000, callback: function(){
	    DIETime++;
		this.scene.start('sceneC');       		
	 }, callbackScope: this, repeat: 1 });
	  playerDieTime.paused = true;
		mode = 0;
        //create swords//
        model = this.add.sprite(20, 29, 'player0');
            this.anims.create({
                key: 'left',
                frames: this.anims.generateFrameNumbers('player0', { start: 29, end: 37 }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'turn',
                frames: [ { key: 'player0', frame: 52 } ],
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'right',
                frames: this.anims.generateFrameNumbers('player0', { start: 73, end: 81 }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'attrackright',
                frames: this.anims.generateFrameNumbers('player0', { start: 82, end: 87 }),
                frameRate: 10,
                repeat: -1
            });

            this.anims.create({
                key: 'attrackleft',
                frames: this.anims.generateFrameNumbers('player0', { start: 39, end: 44 }),
                frameRate: 10,
                repeat: -1
            });
		    this.anims.create({//for heart  animation//
             key: 'hearting',
             frames: this.anims.generateFrameNumbers('heart', { start: 0, end: 2 }),
             frameRate: 10,
             repeat: -1
        });

          swordAnimation.call(this);//swordcreate//

          heart = this.add.sprite(50,10,'heart');
		  heart1 = this.add.sprite(-10,10,'heart');
		  
		  heart.alpha = 0;
		  heart1.alpha = 0;
		  player = this.add.container(x,y,[model,swords,heart,heart1]);
	      this.physics.world.enable(player);
	      player.body.setSize(39,50,true).setOffset(0,8);;	  
		  player.body.setBounce(0);
		  player.body.setCollideWorldBounds(true);
	      this.physics.add.collider(player, platforms);
    }//swords

    function player1Creation(x,y){//arrower
       mode == 1;
        //create player//
        model = this.add.sprite(x, y,'player1');//
        

        this.anims.create({
            key: 'left',
            frames: this.anims.generateFrameNumbers('player1', { start: 36, end: 44 }),
            frameRate: 10,
            repeat: -1
        });

        this.anims.create({
            key: 'turn',
            frames: [ { key: 'player1', frame: 58 } ],
            frameRate: 10,
            repeat: -1
        });

        this.anims.create({
            key: 'right',
            frames: this.anims.generateFrameNumbers('player1', { start: 94, end: 102 }),
            frameRate: 10,
            repeat: -1
        });

        this.anims.create({
            key: 'attrackright',
            frames: this.anims.generateFrameNumbers('player1', { start: 103, end: 115 }),
            frameRate: 10,
            repeat: -1
        });

        this.anims.create({
            key: 'attrackleft',
            frames: this.anims.generateFrameNumbers('player1', { start: 45, end: 57 }),
            frameRate: 10,
            repeat: -1
        });
		
		
		player = this.add.container(x,y,[model]);
	      this.physics.world.enable(player);
	      player.body.setSize(39,58,(0,0));
		  player.body.setCollideWorldBounds(true);
	      this.physics.add.collider(player, platforms);       
     }
	 
    function playerHit(player,arrow){
      arrow.disableBody(true,true);
    }

    function swordAnimation(){
      swords = this.add.sprite(20,29,'glowsword');
      this.anims.create({
          key: 'swordsRight',
          frames: this.anims.generateFrameNumbers('glowsword', { start: 15, end: 17 }),
          frameRate: 5,
          repeat: -1
      });

      this.anims.create({
          key: 'stay',
          frames: [ { key: 'glowsword', frame: 0} ],
          frameRate: 10,
          repeat: -1
      });	  
    }
	
	function attackingArea(){
	  if (left){
	    attackAreas = this.physics.add.sprite(player.body.x-20,player.body.y+30,'arrow');
	  }
	  else if(right){
	    attackAreas = this.physics.add.sprite(player.body.x+60,player.body.y+30,'arrow');
	  }
      else {
	    attackAreas = this.physics.add.sprite(player.body.x+60,player.body.y+30,'arrow');
	  }	  
	  attackAreas.body.setSize(39,58,(0,2));
	  attackAreas.body.setAllowGravity(false);
	  attackAreas.alpha = 0;
	  attackAreas.setBounce(0);
	  this.time.delayedCall(300,disableIt,[],this);
	  this.physics.add.overlap(attackAreas,enemies, killEnemy, null, this);
	  this.physics.add.overlap(attackAreas,scene3Boss, killBoss, null, this);
	  this.physics.add.overlap(attackAreas,dummy, killEnemy, null, this);
	  this.physics.add.collider(attackAreas, platforms);
	}
	
	function killEnemy(attackAreas,enemy){
	  
	  this.sound.playAudioSprite('sfx1','boss hit');//soundevent//
	  if (enemy == dummy){	  
	    dummy.tint = 0xFF0000;
        this.time.delayedCall(300,function(){
		
		dummy.tint = 0xFFFFFF;
		},[],this);	
	  }	   
	  else enemy.disableBody(true,true);	  
	}
	
	function killBoss(attackAreas,boss){
	  
	  this.sound.playAudioSprite('sfx1','boss hit');//soundevent//
	  if (scene3_ctr < 5&&this.time.now-scene3_time>1000){	  
	    boss.tint = 0xFF0000;
		scene3_ctr++;
        this.time.delayedCall(300,function(){
		boss.tint = 0xFFFFFF;
		},[],this);	
		scene3_time=this.time.now;
		apple_num+=3;
	  }	   
	  if(scene3_ctr > 4)
	  {
	  KeyDoor = this.physics.add.sprite(boss.body.x,boss.body.y,'Keys');//key create//
	  boss.disableBody(true,true);	
	  scene3pass=true;
	  this.physics.add.collider(platforms, KeyDoor);
	  this.physics.add.overlap(player, KeyDoor, function(){		 
	     KeyID[1] = true ; KeyDoor.disableBody(true,true);
		}, null, this);
	  if(KeyID[1]==true)
	  {
		KeyDoor.disableBody(true,true);
	  }
	  }  
	}
	function disableIt(){
	  attackAreas.disableBody(true, true);
	}
	
	function ChangeScene(player,goto){
	   cursors.left.isDown = false;
	   cursors.up.isDown = false;
	   cursors.right.isDown = false;
	   if(goto == goTo1){		 
	     this.scene.start('scene1');		 
	   }
	   else if (goto == goTo2){
	     scene2_reload=false; 
		 scene2_reached_bossstage=false;
	     this.scene.start('scene2');
	   }
	   else if (goto == goTo3){	     
	     this.scene.start('scene3');		 
	   }
	   else if(goto == goTo4[0] || goto == goTo4[1]){
	     this.scene.start('scene4');
	   }
	}

	function PreLoadScene1Enemies(){		
	  this.load.spritesheet('enemy','assets/enemy/outside/rajce.png',
        { frameWidth: 46, frameHeight: 52 });
		    enemiesX = 50;
	}
	
	function PreLoadScene2Enemies(){
	   this.load.spritesheet('starenemy','assets/enemy/cliffs/star.png',
	     { frameWidth: 50, frameHeight: 35 });
	}
	
	function CreateScene1Enemies(x,y){	
	  var enemy = this.physics.add.sprite(x,y,'enemy');//300,525
	  enemy.setCollideWorldBounds(true);
	  enemy.body.velocity.x = 50;
	  enemy.body.setSize(39,43,(0,0));
      enemy.body.setBounce(0.2);
            this.anims.create({
                key: 'enemyleft',
                frames: this.anims.generateFrameNumbers('enemy', { start: 11, end: 17 }),
                frameRate: 10,
                repeat: -1
            });	  
	  this.tweens.timeline({
              targets: enemy.body.velocity,
              loop: -1,
              tweens: [
               { x: 50, y: 0, duration: 4000, ease: 'Stepped', 
				onStart: function(){enemy.flipX = !enemy.flipX;
				enemy.anims.play('enemyleft',true);} },
               { x: -50, y: 0, duration: 4000, ease: 'Stepped', 
				onStart: function(){enemy.flipX = !enemy.flipX;
				enemy.anims.play('enemyleft',true);}}					   
               ]});
					 	  
	  enemies.add(enemy);
	  this.physics.add.collider(enemies,platforms);
	}

	function CreateScene2Enemies(x,y){
	  var enemy = this.physics.add.sprite(x,y,'starenemy');//300,525
	  enemy.setCollideWorldBounds(true);
	  enemy.body.setSize(200,36,(2,2));

            this.anims.create({
                key: 'starmove',
                frames: this.anims.generateFrameNumbers('starenemy', { start: 4, end: 7 }),
                frameRate: 10,
                repeat: -1
            });
	  this.tweens.timeline({
              targets: enemy.body.velocity,
              loop: -1,
              onUpdate: function(){
			    enemy.anims.play('starmove',true);
			    },			  
              tweens: [
                       { x: 50, y: 0, duration: 4000, ease: 'Stepped'},
                       { x: -50, y: 0, duration: 4000, ease: 'Stepped'}
                      ]
                     });

	  enemies.add(enemy);

	  this.physics.add.collider(enemies,platforms);

	}
	
	function enemies2Overlap(player,enemy){//for detect to attack player//
      //console.log(this.time.now);	
	  if (this.time.now > enemyTimer){
	    if(enemy.body.x < player.body.x){//shooting direction//
		  var enemyAttack = enemiesAttack.create( enemy.body.x+78+10, enemy.body.y+18, 'red' );
		  enemyAttack.setVelocity(120,0);//shooting speed//
		}
		else {
		   var enemyAttack = enemiesAttack.create( enemy.body.x+78-10, enemy.body.y+18, 'red' );
		   enemyAttack.setVelocity(-120,0);//shooting speed//
		}
	     console.log("enemy shoot");
	     enemyTimer = this.time.now + 2200;		 
	     enemyAttack.setScale(0.2);
         enemyAttack.setCollideWorldBounds(true);
		 this.time.delayedCall(2200,function(){
		 enemyAttack.disableBody(true,true);
		},[],this);
	  }
	  		  		
	}
	
	function enemy2Demage(player,enemyAttack){
	  playerDemage.call(this,player,enemyAttack);
	  enemyAttack.disableBody(true,true);
	  
	}
	
	function NPCSpeak(words,n){	  
	  notices[n].alpha = 1;
	  textBox[n].alpha = 1;
	  textBox[n].setText(words);
	}
	
	function NPCBoxCreation(){
	  notices[0] = this.add.image(800+50,400+20,'notice');
	  textBox[0] = this.add.bitmapText(800, 400, 'nokia', 'Hi', 15);
	  notices[0].setScale(1,0.4);
	  notices[0].alpha = 0;
	  textBox[0].alpha = 0;
	  notices[1] = this.add.image(950,400+20,'notice');
	  textBox[1] = this.add.bitmapText(900, 400, 'nokia', 'Yo', 15);
	  notices[1].setScale(1,0.4);
	  notices[1].alpha = 0;
	  textBox[1].alpha = 0;	  	  
	}
	
	function TextBoxReset(){
	   if (npc0D){	     
	     if(Phaser.Math.Difference(player.body.x,838)>50){
		   talkState[0]=0;
		   notices[0].alpha = 0;
	       textBox[0].alpha = 0;
		   npc0D = false;
		  }
	   }
	   else if (npc1D){
	     if(Phaser.Math.Difference(player.body.x,931)>50){
		   talkState[1]=0;
		   notices[1].alpha = 0;
	       textBox[1].alpha = 0;
		   npc1D = false;
		 }	  
	   }
	}
	
	function playerDemage(player,enemy){
	  
	  if(this.time.now > timer){
	    timer = this.time.now + 500;
	    console.log("hited");
	    playerBlood -=10;
		model.tint = 0xFF0000;
		//speed = -speed;
		this.sound.playAudioSprite('sfx1','meow');//soundevent//
        this.time.delayedCall(300,function(){
		model.tint = 0xFFFFFF;
		//speed = -speed;
		},[],this);		
	  }	  
      textBlood.setText("PlayerBlood: "+playerBlood);	  
	}
	
	function nomarlText(){
	  //set text//
	  textBlood = this.add.text( 50, 48, 'PlayerBlood: '+ playerBlood, { fontSize: '30px', color: '#000000', fontStyle: 'bold italic' }).setScrollFactor(0);
      textSetting = this.add.text(20,20,'Direction: ',{ color: '#000000',fontStyle: 'bold italic' }).setScrollFactor(0);
	}
	
	function updatetextSetting(){
	 textBlood.setText("PlayerBlood: "+playerBlood);  
	  /*textSetting.setText(sceneName +" "+wordsSetting+' Move: '+canMove+" x:"+player.body.x+" Y:"+player.body.y+
	  "\nBoss3: "+bossblood[3]+" Press?: "+ (cursors.left.isDown || cursors.right.isDown)+"(M)usic: "+!music.mute+"\n Die Time: "+DIETime+" ctr"+scene3_ctr);
	  */
	  textSetting.setText('Background Music(M): '+ !music.mute);
	  }
     
    function bossCreation(num,x,y){
     boss[0] = this.add.sprite(80,30,'Dragon');
	 boss[1] = this.add.sprite(40,30,'bomb');
	 boss[2] = this.add.sprite(90,30,'bomb');
	
     boss[num] = this.add.container(x,y,[boss[0],boss[1],boss[2]]);
	 this.physics.world.enable(boss[num]);
	 boss[num].body.allowGravity = false;
	 boss[num].body.setSize(160,60,(1,4));
	 bossAttacks = this.physics.add.group();
	 boss[0].flipX = true;
	 this.anims.create({
                key: 'boss3right',
                frames: this.anims.generateFrameNumbers('Dragon', { start: 0, end: 7 }),
                frameRate: 10,
                repeat: -1
            });
	 this.anims.create({
                key: 'bombexpored',
                frames: this.anims.generateFrameNumbers('bomb', { start: 0, end: 7 }),
                frameRate: 10,
                repeat: -1
            });
     this.anims.create({
                key: 'DragonBomb',
                frames: this.anims.generateFrameNumbers('bomb', { start: 5, end: 7 }),
                frameRate: 10,
                repeat: -1
            });

	 boss[1].anims.play('DragonBomb',true);
	 boss[2].anims.play('DragonBomb',true);
	 boss[1].alpha = 0;
	 boss[2].alpha = 0;
	 console.log('loading');
	 bosstimedEvent[0] = this.time.addEvent({ delay: 8000, callback: function(){//for right
	   bossDir = 1;
	   bossAct = 1;
	 }, callbackScope: this, loop: true });
	 bosstimedEvent[0].paused = true;
	 
	 bosstimedEvent[1] = this.time.addEvent({ delay: 8000, callback: function(){//for left
	   bossDir = 2;
	   bossAct = 2;	   
	 }, callbackScope: this, loop: true });     
	 bosstimedEvent[1].paused = true;
	 
	 bosstimedEvent[2] = this.time.addEvent({ delay: 1000, callback: function(){
	   bossAct = -1;
	   notices[1].alpha = 1;
	   textBox[1].alpha = 1;
	   textBox[1].setText('I will \nkill you!');
	   bosstimedEvent[2].paused = true;
	   bosstimedEvent[3].paused = false;
	 }, callbackScope: this, loop: true });     
	 bosstimedEvent[2].paused = true;
	 
	 bosstimedEvent[3] = this.time.addEvent({ delay: 2000, callback: function(){
	   notices[1].alpha = 0;
	   textBox[1].alpha = 0;
	   boss[3].body.setVelocity(-110,0);
       bosstimedEvent[4].paused = false;
       bosstimedEvent[3].paused = true;	   
	 }, callbackScope: this, loop: true });     
	 bosstimedEvent[3].paused = true;
	 
	 bosstimedEvent[4] = this.time.addEvent({ delay: 2000, callback: function(){
	   if(bossDir == 1) bossAct = 1;
	   else bossAct = 2;
	   boss[num].body.setVelocity(0,0);
	   console.log("x:"+boss[3].body.x+" Y:"+boss[3].body.y);
	   boss[3].body.setVelocity(0,0);
       bosstimedEvent[4].paused = true;		   
	 }, callbackScope: this, loop: true });     
	 bosstimedEvent[4].paused = true;
	 
	 bosstimedEvent[5] = this.time.addEvent({ delay: 3000, callback: function(){
	   bossAct = 4;	//supperpower//   
	   boss[3].body.setVelocity(0,0);
       bosstimedEvent[5].paused = true;		   
	 }, callbackScope: this, loop: true });     
	 bosstimedEvent[5].paused = true;
	 
	 bosstimedEvent[6] = this.time.addEvent({ delay: 5000, callback: function(){	   	   
	   boss[3].body.setVelocity(0,+80);
	   bosstimedEvent[4].paused = false;//for restart position//
       bosstimedEvent[6].paused = true;		   
	 }, callbackScope: this, loop: true });     
	 bosstimedEvent[6].paused = true;	
 
     //for dragon dieing//
     bosstimedEvent[7] = this.time.addEvent({ delay: 1000, callback: function(){	   	   
	   boss[3].alpha -= 0.1;
       bossDes[0].body.x = boss[num].body.x;
	   bossDes[0].body.y = boss[num].body.y;
       //bossDes[0].alpha = 1;
       boss[1].alpha = 1;
       boss[2].alpha = 1;	   
       console.log(boss[3].alpha);       	   
	 }, callbackScope: this, repeat: 9 });     
	 bosstimedEvent[7].paused = true;
	 
	 bossDes[0] = this.physics.add.sprite(boss[num].body.x,boss[num].body.y,'bomb')
	 bossDes[0].body.setAllowGravity(false);
	 bossDes[0].anims.play('DragonBomb',true);
	 bossDes[0].alpha = 0;
	 
	 boss[0].anims.play('boss3right',true);
      
   }
   
   function bossUpdate(num){
   
    if (bossAct == 0){
	  notices[0].alpha = 1;
	  textBox[0].alpha = 1;
	  bosstimedEvent[2].paused = false;
	}
	else if (bossAct==1){	   
	   boss[0].flipX = false;
	   bosstimedEvent[0].paused = true;
	   bosstimedEvent[1].paused = false;
	   boss[num].body.setVelocity(50,0);
	}
	else if (bossAct == 2){
	   boss[0].flipX = true;
	   bosstimedEvent[1].paused = true;
	   bosstimedEvent[0].paused = false;
	   boss[num].body.setVelocity(-50,0);
	}   
    if(bossAct == 1 || bossAct == 2){
	  if(this.time.now > bosstimer[1]){
	    bosstimer[1] = this.time.now +5000;
	    bosstimer[0] = this.time.now +1000;
	    specialBomb = this.physics.add.sprite(boss[num].body.x+80,boss[num].body.y+80,'bomb2');
	    specialBomb.setBounce(1);
	    specialBomb.setVelocity(0,20);
        specialBomb.setCollideWorldBounds(true);
	} 
      else if (this.time.now > bosstimer[0]){
	    bosstimer[0] = this.time.now +1000;
	    var bomb = bossAttacks.create(boss[num].body.x+80,boss[num].body.y+80,'bomb');
        bomb.body.offset.y=-10;     	  
	    bomb.setBounce(1);
        bomb.setCollideWorldBounds(true);
        bomb.setVelocity(Phaser.Math.Between(-200, 200), 20);
	}
    if (bossblood[num] == 70 && bosssuperpower==2){
	  bossAct = 3;
	  bosstimedEvent[0].paused = true;
	  bosstimedEvent[1].paused = true;
      bosstimedEvent[5].paused = false;  
	  boss[num].body.setVelocity(0,-50);
	}
	else  if (bossblood[num] == 40&& bosssuperpower==3){
	  bossAct = 3;
	  bosstimedEvent[0].paused = true;
	  bosstimedEvent[1].paused = true;
      bosstimedEvent[5].paused = false;  
	  boss[num].body.setVelocity(0,-50);
	}
	else  if (bossblood[num] == 10&& bosssuperpower==4){
	  bossAct = 3;
	  bosstimedEvent[0].paused = true;
	  bosstimedEvent[1].paused = true;
      bosstimedEvent[5].paused = false;  
	  boss[num].body.setVelocity(0,-50);
	}
	 if(bossblood[num] <= 0){
	  for (var i=0;i<6;i++){
	    bosstimedEvent[i].paused = true;
	  }
	  bossAct = 7;//stop looping//
	  playerBlood +=10;
	  boss[num].body.setVelocity(0,0);
	}
	 this.physics.add.collider(platforms,bossAttacks,expored,null,this);
	 this.physics.add.collider(specialBomb,platforms,RebounceTo,null,this);
	 this.physics.add.collider(specialBomb,player,RebounceTo,null,this);
	 this.physics.add.collider(player,bossAttacks,expored,null,this);	
	}     
	
	//blood for superpower//
	if (bossAct == 4 && bosssuperpower==2){
	  bossAct = 5;	  
	   for(var i=0;i<50;i++){	    		
		if (i%3 != 0 ){}
		else {
		  var bomb = bossAttacks.create(10+i*50,80,'bomb');
          bomb.body.offset.y=-10;     	  
	      bomb.setBounce(0.1);
          bomb.setCollideWorldBounds(true);
          bomb.setVelocity(0, 15);
		}
		bosstimedEvent[6].paused = false;
	   }
	   bosssuperpower=3;
	   //boss[num].body.reset(boss[num].body.x+50,70);
	}
	else if(bossAct == 4 && bosssuperpower==3){
	  bossAct = 5;	  
	   for(var i=0;i<50;i++){	    		
		if (i%3 == 0 ){}
		else {
		  var bomb = bossAttacks.create(10+i*50,80,'bomb');
          bomb.body.offset.y=-10;     	  
	      bomb.setBounce(0.1);
          bomb.setCollideWorldBounds(true);
          bomb.setVelocity(0, 15);
		}
		bosstimedEvent[6].paused = false;
	   }
	   bosssuperpower=4;
	   //boss[num].body.reset(boss[num].body.x+50,70);
	}
	else if (bossAct == 4 && bosssuperpower==4){
	   bossAct = 5;	  
	   for(var i=0;i<50;i++){	    		
		if (i%2 == 0 || i==3 ){}
		else {
		  var bomb = bossAttacks.create(10+i*50,80,'bomb');
          bomb.body.offset.y=-10;     	  
	      bomb.setBounce(0.1);
          bomb.setCollideWorldBounds(true);
          bomb.setVelocity(0, 15);
		}
		bosstimedEvent[6].paused = false;
	   }
	   bosssuperpower=5;
	  //boss[num].body.reset(boss[num].body.x+50,70);
	}    
    else if(bossAct == 7){
	   bossAct = 8;
	   boss[0].anims.play('boss3right',false);
	   playingState = 2;
	   textBox[0].setText('you kill \nthe dragon!');
       bosstimedEvent[7].paused = false;  	   
	 }	
    
	if(boss[num].alpha<0.1 && bossAct == 8){
	  bossAct = 9;
	  princess.disableBody(true,true);
	  notices[0].alpha = 0;
	  textBox[0].alpha = 0;
	  princess = this.physics.add.sprite(720,360,'princess');
	}
	else if(bossAct==9){
	  this.physics.add.collider(princess,platforms,function(){
	   if (princess.body.x>player.body.x)
	     princess.body.setVelocity(-50,0);
	   else {
	     princess.body.setVelocity(50,0);
		 player.flipX = true;
	   }
	  },null,this);
	}
	if(Phaser.Math.Difference(player.body.x,princess.body.x)<50 && princess.body.y>600){
	  if(princess.body.x>player.body.x){ 
	  heart.anims.play('hearting',true);
	  heart.alpha = 1;
	  }
	  else {
	   heart1.anims.play('hearting',true);
	  heart1.alpha = 1;
	  }	 
	  princess.body.setVelocity(0,0);
	  playerDieTime.paused = false;
	  bossAct = 10;
	 }
   }
   
   function RebounceTo(specialBomb,players){
      if(players==player){

		attackAreas = this.physics.add.sprite(specialBomb.body.x-20,specialBomb.body.y+30,'bomb2');
		attackAreas.setVelocityY(-550);
		this.time.delayedCall(1200,function(){
		attackAreas.destroy();
		},[],this);
		this.physics.add.collider(attackAreas,boss[3],function(){
		  boss[0].tint = 0x000000;
		  this.sound.playAudioSprite('sfx1','boss hit');//soundevent//		  
		  attackAreas.disableBody(true,true);
		  bossblood[3]-= 10;
		  this.time.delayedCall(300,function(){ boss[0].tint =0xFFFFFF},[],this);
		  },null,this);
	  }  
       specialBomb.destroy();    	  
   }
   
   function scene3_dam(player, enemy){
   if (jump_b == true){
	   playerDemage.call(this,player,enemy);
	 }
   }
   
   function expored(platforms,bomb){
     this.sound.playAudioSprite('sfx1','alien death');//soundevent//
	 bomb.anims.play('bombexpored', true);
	 this.time.delayedCall(600,function(){
		bomb.destroy();
		},[],this);	
	 if (platforms == player){
	   playerDemage.call(this,player,bomb);
	   bomb.disableBody(true,true);
	 }
   }

   function resetData(){
   	
	//music.restart();
	playerPosX=880;
	playerPosY=450;
    bossblood = [100,100,100,100];
	bossDes=[0,1,2];
	playerBlood = 100+(DIETime*10);
	bossAct=-2;
	bossenable=false;
   
   }
   
   function detectPlayerBlood(){
     
	 if(playerBlood < 0.1){	    
	    
		player.setAngle(90);		
		player.body.setSize(58,39,(0,0));
		playingState = 1;
		model.anims.play('turn');
		this.physics.pause();
		playerDieTime.paused = false;
	 }
   }
   
   function makeButton(name, x, y){
    var button = this.add.image(x, y, 'button', 1).setInteractive();
    button.name = name;
    button.setScale(2, 1.5);

    var text = this.add.bitmapText(x - 40, y - 8, 'nokia', name, 16);
    text.x += (button.width - text.width) / 2;
}

   function makephysicsbutton(name,x,y){
  var button = this.add.image(x,y,'button',1);
  button.name = name;
  button.setScale(2, 1.5);

  var text = this.add.bitmapText(x - 40, y - 8, 'nokia', name, 16);
  text.x += (button.width - text.width) / 2;

  container = this.add.container(5,5,[button,text]);
  container.setSize(button.width*2,button.height).setInteractive();
}

   function setButtonFrame(button, frame){
    button.frame = button.scene.textures.getFrame('button', frame);
}
   
   function musicPreLoad(){
    //music//
    this.load.audioSprite('sfx', 'assets/audio/fx_game.json', [
     'assets/audio/fx_game.ogg','assets/audio/fx_game.mp3']);
	this.load.audioSprite('sfx1', 'assets/audio/fx_mixdown.json', [
     'assets/audio/fx_mixdown.ogg','assets/audio/fx_mixdown.mp3']);
    this.load.audio('theme', ['assets/audio/adventure(C).ogg','assets/audio/adventure(C).mp3']);
	this.load.spritesheet('heart', 'assets/characters/heart.png', { frameWidth: 48, frameHeight: 48 });
	
   }
   
   function musicCreation(){
     soundEvent[0] = this.cache.json.get('sfx').spritemap;
	 soundEvent[1] = this.cache.json.get('sfx1').spritemap;
     music = this.sound.add('theme');
     music.play();
	 music.loop = true;
   }
   
   var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 300 },
                debug: false
            }
        },
        scene: [SceneC,Scene0,Scene4,Scene2,Scene1,Scene3]
    };

   var game = new Phaser.Game(config);

    </script>
  </body>
</html>
